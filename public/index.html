<!DOCTYPE html> 
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OrionQR - Control Totem</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Lobster:wght@400&display=swap" rel="stylesheet">
  <style>
    body { background-color: #F8E1E9; }
    #admin-panel { display: none; }
    .text-preview {
      width: 256px;
      height: 704px;
      background-color: #F8E1E9;
      position: relative;
      overflow: hidden;
      margin-bottom: 1rem;
    }
    .preview-text {
      position: absolute;
      width: 100%;
      text-align: center;
      white-space: pre-wrap;
      animation: subtleAnimation 30s infinite;
    }
    @keyframes subtleAnimation {
      0% { opacity: 0; transform: translateY(20px); }
      5% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      95% { opacity: 0.8; transform: translateY(-10px); }
      100% { opacity: 0; transform: translateY(20px); }
    }
    @keyframes backgroundAnimation {
      0% { background-color: var(--color1); }
      33% { background-color: var(--color2); }
      66% { background-color: var(--color3, var(--color1)); }
      100% { background-color: var(--color1); }
    }
    .animated-bg {
      animation: backgroundAnimation var(--animation-duration, 15s) infinite;
    }
    .color-input {
      width: 50px; /* Reduced size for compactness */
      height: 30px;
    }
  </style>
</head>
<body class="font-['Playfair_Display'] text-gray-800">
  <div class="min-h-screen flex flex-col items-center justify-center p-4">
    <h1 class="text-3xl text-[#D4A017] mb-6">OrionQR - Control Totem LED</h1>
    <input id="admin-password" type="password" placeholder="Contraseña" class="w-full max-w-md p-2 mb-4 border rounded">
    
    <div id="admin-panel" class="w-full max-w-md bg-white p-6 rounded shadow">
      <h2 class="text-2xl mb-4">Opciones</h2>
      
      <div class="mb-6">
        <h3 class="text-xl mb-2">Cargar Foto/Video</h3>
        <input id="media-upload" type="file" accept="image/jpeg,image/png,video/mp4,video/quicktime" class="w-full p-2 border rounded">
        <button id="upload-btn" class="mt-2 w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Subir y Mostrar</button>
      </div>
      
      <div class="mb-6">
        <h3 class="text-xl mb-2">Color de Fondo</h3>
        <div class="grid grid-cols-3 gap-2">
          <button class="bg-black text-white p-2 rounded" onclick="setColor('black')">Negro (Apagar)</button>
          <button class="bg-red-500 text-white p-2 rounded" onclick="setColor('red')">Rojo</button>
          <button class="bg-blue-500 text-white p-2 rounded" onclick="setColor('blue')">Azul</button>
          <button class="bg-green-500 text-white p-2 rounded" onclick="setColor('green')">Verde</button>
          <button class="bg-yellow-500 text-white p-2 rounded" onclick="setColor('yellow')">Amarillo</button>
          <button class="bg-[#F8E1E9] text-gray-800 p-2 rounded border" onclick="setColor('#F8E1E9')">Rosa</button>
        </div>
        <input id="custom-color" type="color" class="mt-2 w-full h-10">
        <button id="custom-color-btn" class="mt-2 w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Aplicar Color Personalizado</button>
        <div class="mt-4">
          <h4 class="text-lg mb-2">Fondo Animado</h4>
          <div class="mb-2 flex items-center">
            <label class="block mr-2">Color 1:</label>
            <input id="bg-color1" type="color" value="#F8E1E9" class="color-input">
          </div>
          <div class="mb-2 flex items-center">
            <label class="block mr-2">Color 2:</label>
            <input id="bg-color2" type="color" value="#D4A017" class="color-input">
          </div>
          <div class="mb-2 flex items-center">
            <label class="block mr-2">Color 3 (opcional):</label>
            <input id="bg-color3" type="color" value="#FFFFFF" class="color-input">
          </div>
          <div class="mb-2">
            <label class="block mb-1">Velocidad Fondo:</label>
            <input id="bg-speed" type="range" min="1" max="30" value="15" class="w-full">
            <span id="bg-speed-value" class="text-sm text-gray-600">15s</span>
          </div>
          <button id="animated-bg-btn" class="w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Aplicar Fondo Animado</button>
          <div class="mt-2">
            <button id="strobe-btn" class="w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Strobe</button>
            <label class="block mb-1 mt-2">Velocidad Strobe:</label>
            <input id="strobe-speed" type="range" min="50" max="1000" value="100" class="w-full">
            <span id="strobe-speed-value" class="text-sm text-gray-600">100ms</span>
          </div>
          <button id="random-colors-btn" class="mt-2 w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Colores Random</button>
        </div>
      </div>
      
      <div class="mb-6">
        <h3 class="text-xl mb-2">Texto Personalizado</h3>
        <textarea id="custom-text" rows="3" placeholder="Ej: Boda de Alejo\n& Valentina" class="w-full p-2 mb-2 border rounded resize-none"></textarea>
        <div class="mb-2">
          <label class="block mb-1">Tipografía:</label>
          <select id="text-font" class="w-full p-2 border rounded">
            <option value="Playfair Display">Playfair Display</option>
            <option value="Roboto">Roboto</option>
            <option value="Montserrat">Montserrat</option>
            <option value="Lobster">Lobster</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="block mb-1">Tamaño del Texto:</label>
          <select id="text-size" class="w-full p-2 border rounded">
            <option value="20">Pequeño (20px)</option>
            <option value="30">Mediano (30px)</option>
            <option value="40">Grande (40px)</option>
            <option value="50">Muy Grande (50px)</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="block mb-1">Color del Texto:</label>
          <input id="text-color" type="color" class="w-full h-10">
        </div>
        <div class="mb-2">
          <label class="block mb-1">Posición Vertical:</label>
          <input id="text-position" type="range" min="0" max="100" value="50" class="w-full">
          <span id="position-value" class="text-sm text-gray-600">50%</span>
        </div>
        <div class="text-preview" id="text-preview">
          <div class="preview-text" id="preview-text">Texto de ejemplo</div>
        </div>
        <button id="text-btn" class="w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Aplicar Texto</button>
      </div>
    </div>
  </div>

  <script>
    const backendUrl = 'https://orionqr.onrender.com';

    // Track the current background state
    let currentBackground = { type: 'color', value: '#F8E1E9' };
    let strobeActive = false;
    let randomColorsActive = false;
    let strobeInterval = null;
    let randomColorInterval = null;

    async function setState({ text, background, media }) {
      try {
        const response = await fetch(`${backendUrl}/state`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, background, media })
        });
        if (!response.ok) throw new Error('Error al actualizar contenido');
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function uploadMedia() {
      const fileInput = document.getElementById('media-upload');
      if (!fileInput.files[0]) {
        alert('Selecciona un archivo');
        return;
      }
      const formData = new FormData();
      formData.append('media', fileInput.files[0]);
      try {
        const response = await fetch(`${backendUrl}/upload`, {
          method: 'POST',
          body: formData
        });
        if (!response.ok) throw new Error('Error al subir archivo');
        const { path } = await response.json();
        const fullMediaUrl = path;

        await setState({ media: fullMediaUrl, text: null, background: currentBackground });
        fileInput.value = '';
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    function setColor(color) {
      stopStrobe();
      stopRandomColors();
      currentBackground = { type: 'color', value: color };
      setState({ background: currentBackground });
      const preview = document.getElementById('text-preview');
      preview.style.backgroundColor = color;
      preview.style.animation = 'none';
      preview.classList.remove('animated-bg');
    }

    function setAnimatedBackground(colors, duration) {
      stopStrobe();
      stopRandomColors();
      currentBackground = { type: 'animatedBackground', value: colors };
      setState({ background: currentBackground });
      const preview = document.getElementById('text-preview');
      preview.style.setProperty('--color1', colors[0]);
      preview.style.setProperty('--color2', colors[1]);
      preview.style.setProperty('--color3', colors[2] || colors[0]);
      preview.style.setProperty('--animation-duration', `${duration}s`);
      preview.style.animation = 'none';
      preview.classList.add('animated-bg');
    }

    function toggleStrobe() {
      stopRandomColors();
      strobeActive = !strobeActive;
      const preview = document.getElementById('text-preview');
      if (strobeActive) {
        const speed = document.getElementById('strobe-speed').value;
        let isBlack = false;
        strobeInterval = setInterval(() => {
          currentBackground = { type: 'color', value: isBlack ? 'black' : document.getElementById('custom-color').value || '#F8E1E9' };
          setState({ background: currentBackground });
          preview.style.backgroundColor = currentBackground.value;
          preview.style.animation = 'none';
          preview.classList.remove('animated-bg');
          isBlack = !isBlack;
        }, speed);
      } else {
        stopStrobe();
        setColor('#F8E1E9'); // Reset to default color
      }
    }

    function stopStrobe() {
      strobeActive = false;
      if (strobeInterval) {
        clearInterval(strobeInterval);
        strobeInterval = null;
      }
    }

    function toggleRandomColors() {
      stopStrobe();
      randomColorsActive = !randomColorsActive;
      const preview = document.getElementById('text-preview');
      if (randomColorsActive) {
        randomColorInterval = setInterval(() => {
          const colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF', '#F8E1E9'];
          const randomColor = colors[Math.floor(Math.random() * colors.length)];
          currentBackground = { type: 'color', value: randomColor };
          setState({ background: currentBackground });
          preview.style.backgroundColor = randomColor;
          preview.style.animation = 'none';
          preview.classList.remove('animated-bg');
        }, 1000);
      } else {
        stopRandomColors();
        setColor('#F8E1E9'); // Reset to default color
      }
    }

    function stopRandomColors() {
      randomColorsActive = false;
      if (randomColorInterval) {
        clearInterval(randomColorInterval);
        randomColorInterval = null;
      }
    }

    function updateTextPreview() {
      const text = document.getElementById('custom-text').value || 'Texto de ejemplo';
      const font = document.getElementById('text-font').value;
      const size = document.getElementById('text-size').value + 'px';
      const color = document.getElementById('text-color').value;
      const position = document.getElementById('text-position').value;
      const previewText = document.getElementById('preview-text');

      previewText.textContent = text;
      previewText.style.fontFamily = `'${font}', serif`;
      previewText.style.fontSize = size;
      previewText.style.color = color;
      previewText.style.top = `${position}%`;
      previewText.style.transform = 'translateY(-50%)';
    }

    document.getElementById('admin-password').addEventListener('input', (e) => {
      if (e.target.value === 'admin123') {
        document.getElementById('admin-panel').style.display = 'block';
      }
    });

    document.getElementById('upload-btn').addEventListener('click', uploadMedia);
    document.getElementById('custom-color-btn').addEventListener('click', () => {
      const color = document.getElementById('custom-color').value;
      setColor(color);
    });

    document.getElementById('animated-bg-btn').addEventListener('click', () => {
      const color1 = document.getElementById('bg-color1').value;
      const color2 = document.getElementById('bg-color2').value;
      const color3 = document.getElementById('bg-color3').value;
      const duration = document.getElementById('bg-speed').value;
      setAnimatedBackground([color1, color2, color3], duration);
    });

    document.getElementById('bg-speed').addEventListener('input', (e) => {
      document.getElementById('bg-speed-value').textContent = `${e.target.value}s`;
      const preview = document.getElementById('text-preview');
      if (preview.classList.contains('animated-bg')) {
        const color1 = document.getElementById('bg-color1').value;
        const color2 = document.getElementById('bg-color2').value;
        const color3 = document.getElementById('bg-color3').value;
        setAnimatedBackground([color1, color2, color3], e.target.value);
      }
    });

    document.getElementById('strobe-btn').addEventListener('click', toggleStrobe);

    document.getElementById('strobe-speed').addEventListener('input', (e) => {
      document.getElementById('strobe-speed-value').textContent = `${e.target.value}ms`;
      if (strobeActive) {
        stopStrobe();
        toggleStrobe(); // Restart strobe with new speed
      }
    });

    document.getElementById('random-colors-btn').addEventListener('click', toggleRandomColors);

    document.getElementById('text-btn').addEventListener('click', () => {
      const text = document.getElementById('custom-text').value;
      const font = document.getElementById('text-font').value;
      const size = document.getElementById('text-size').value;
      const color = document.getElementById('text-color').value;
      const position = document.getElementById('text-position').value;
      if (!text) {
        alert('Por favor, ingresa un texto');
        return;
      }
      const textConfig = { text, font, size: parseInt(size), color, position: parseInt(position) };
      setState({ text: textConfig, background: currentBackground, media: null });
    });

    document.getElementById('custom-text').addEventListener('input', updateTextPreview);
    document.getElementById('text-font').addEventListener('change', updateTextPreview);
    document.getElementById('text-size').addEventListener('change', updateTextPreview);
    document.getElementById('text-color').addEventListener('input', updateTextPreview);
    document.getElementById('text-position').addEventListener('input', (e) => {
      document.getElementById('position-value').textContent = `${e.target.value}%`;
      updateTextPreview();
    });

    updateTextPreview();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93893b37c8b5c000',t:'MTc0NjAzOTA5NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>
