<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OrionQR - Control Totem</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Lobster:wght@400&display=swap" rel="stylesheet">
  <style>
    body { background-color: #F8E1E9; }
    #admin-panel { display: none; }
    .text-preview {
      width: 256px;
      height: 704px;
      background-color: #F8E1E9;
      position: relative;
      overflow: hidden;
      margin-bottom: 1rem;
    }
    .preview-text, .preview-logo {
      position: absolute;
      width: 100%;
      text-align: center;
      white-space: pre-wrap;
    }
    .preview-text {
      animation: subtleAnimation 30s infinite;
    }
    .preview-logo img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      position: absolute;
      left: 50%;
      transform: translateX(-50%) translateY(-50%);
    }
    @keyframes subtleAnimation {
      0% { opacity: 0; transform: translateY(20px); }
      5% { opacity: 1; transform: translateY(0); }
      90% { opacity: 1; transform: translateY(0); }
      95% { opacity: 0.8; transform: translateY(-10px); }
      100% { opacity: 0; transform: translateY(20px); }
    }
    @keyframes backgroundAnimation {
      0% { background-color: var(--color1); }
      33% { background-color: var(--color2); }
      66% { background-color: var(--color3, var(--color1)); }
      100% { background-color: var(--color1); }
    }
  </style>
</head>
<body class="font-['Playfair_Display'] text-gray-800">
  <div class="min-h-screen flex flex-col items-center justify-center p-4">
    <h1 class="text-3xl text-[#D4A017] mb-6">OrionQR - Control Totem LED</h1>
    <input id="admin-password" type="password" placeholder="Contraseña" class="w-full max-w-md p-2 mb-4 border rounded">
    
    <div id="admin-panel" class="w-full max-w-md bg-white p-6 rounded shadow">
      <h2 class="text-2xl mb-4">Opciones</h2>
      
      <div class="mb-6">
        <h3 class="text-xl mb-2">Cargar Foto/Video</h3>
        <input id="media-upload" type="file" accept="image/jpeg,image/png,video/mp4,video/quicktime" class="w-full p-2 border rounded">
        <button id="upload-btn" class="mt-2 w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Subir y Mostrar</button>
      </div>
      
      <div class="mb-6">
        <h3 class="text-xl mb-2">Color de Fondo</h3>
        <div class="grid grid-cols-3 gap-2">
          <button class="bg-black text-white p-2 rounded" onclick="setColor('black')">Negro (Apagar)</button>
          <button class="bg-red-500 text-white p-2 rounded" onclick="setColor('red')">Rojo</button>
          <button class="bg-blue-500 text-white p-2 rounded" onclick="setColor('blue')">Azul</button>
          <button class="bg-green-500 text-white p-2 rounded" onclick="setColor('green')">Verde</button>
          <button class="bg-yellow-500 text-white p-2 rounded" onclick="setColor('yellow')">Amarillo</button>
          <button class="bg-[#F8E1E9] text-gray-800 p-2 rounded border" onclick="setColor('#F8E1E9')">Rosa</button>
        </div>
        <input id="custom-color" type="color" class="mt-2 w-full h-10">
        <button id="custom-color-btn" class="mt-2 w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Aplicar Color Personalizado</button>
        <div class="mt-4">
          <h4 class="text-lg mb-2">Fondo Animado</h4>
          <div class="mb-2">
            <label class="block mb-1">Color 1:</label>
            <input id="bg-color1" type="color" value="#F8E1E9" class="w-full h-10">
          </div>
          <div class="mb-2">
            <label class="block mb-1">Color 2:</label>
            <input id="bg-color2" type="color" value="#D4A017" class="w-full h-10">
          </div>
          <div class="mb-2">
            <label class="block mb-1">Color 3 (opcional):</label>
            <input id="bg-color3" type="color" value="#FFFFFF" class="w-full h-10">
          </div>
          <button id="animated-bg-btn" class="w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Aplicar Fondo Animado</button>
        </div>
      </div>
      
      <div class="mb-6">
        <h3 class="text-xl mb-2">Texto Personalizado</h3>
        <textarea id="custom-text" rows="3" placeholder="Ej: Boda de Alejo\n& Valentina" class="w-full p-2 mb-2 border rounded resize-none"></textarea>
        <div class="mb-2">
          <label class="block mb-1">Tipografía:</label>
          <select id="text-font" class="w-full p-2 border rounded">
            <option value="Playfair Display">Playfair Display</option>
            <option value="Roboto">Roboto</option>
            <option value="Montserrat">Montserrat</option>
            <option value="Lobster">Lobster</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="block mb-1">Tamaño del Texto:</label>
          <select id="text-size" class="w-full p-2 border rounded">
            <option value="20">Pequeño (20px)</option>
            <option value="30">Mediano (30px)</option>
            <option value="40">Grande (40px)</option>
            <option value="50">Muy Grande (50px)</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="block mb-1">Color del Texto:</label>
          <input id="text-color" type="color" class="w-full h-10">
        </div>
        <div class="mb-2">
          <label class="block mb-1">Posición Vertical:</label>
          <input id="text-position" type="range" min="0" max="100" value="50" class="w-full">
          <span id="position-value" class="text-sm text-gray-600">50%</span>
        </div>
        <div class="text-preview" id="text-preview">
          <div class="preview-text" id="preview-text">Texto de ejemplo</div>
          <div class="preview-logo" id="preview-logo" style="display: none;">
            <img id="logo-image" src="" alt="Logo Orion">
          </div>
        </div>
        <button id="text-btn" class="w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14]">Aplicar Texto</button>
      </div>

      <div class="mb-6">
        <h3 class="text-xl mb-2">Logo Orion</h3>
        <div class="grid grid-cols-2 gap-2 mb-2">
          <button id="logo-black-btn" class="bg-gray-800 text-white p-2 rounded">Logo Negro</button>
          <button id="logo-white-btn" class="bg-gray-200 text-gray-800 p-2 rounded border">Logo Blanco</button>
        </div>
        <button id="hide-logo-btn" class="w-full bg-[#D4A017] text-white p-2 rounded hover:bg-[#b88a14] mb-2" style="display: none;">Ocultar Logo</button>
        <div class="mb-2">
          <label class="block mb-1">Posición Vertical:</label>
          <input id="logo-position" type="range" min="0" max="100" value="50" class="w-full">
          <span id="logo-position-value" class="text-sm text-gray-600">50%</span>
        </div>
        <div class="mb-2">
          <label class="block mb-1">Escala del Logo (Tamaño):</label>
          <input id="logo-scale" type="range" min="20" max="100" value="100" class="w-full">
          <span id="logo-scale-value" class="text-sm text-gray-600">100%</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    const backendUrl = 'https://orionqr.onrender.com';
    let currentBackground = { type: 'color', value: '#F8E1E9' };
    let currentLogo = null;

    const logoBlackUrl = 'https://res.cloudinary.com/ddhie4lad/image/upload/v1746448953/LOGO_ORION_NEGRO_asgrem.png?w=256&h=704&c=fit';
    const logoWhiteUrl = 'https://res.cloudinary.com/ddhie4lad/image/upload/v1746448953/LOGO_ORION_BLANCO_yar1ed.png?w=256&h=704&c=fit';

    async function setState({ text, background, media, logo }) {
      try {
        const response = await fetch(`${backendUrl}/state`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ text, background, media, logo })
        });
        if (!response.ok) throw new Error('Error al actualizar contenido');
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    async function uploadMedia() {
      const fileInput = document.getElementById('media-upload');
      if (!fileInput.files[0]) {
        alert('Selecciona un archivo');
        return;
      }
      const formData = new FormData();
      formData.append('media', fileInput.files[0]);
      try {
        const response = await fetch(`${backendUrl}/upload`, {
          method: 'POST',
          body: formData
        });
        if (!response.ok) throw new Error('Error al subir archivo');
        const { path } = await response.json();
        const fullMediaUrl = path;

        await setState({ media: fullMediaUrl, text: null, background: currentBackground, logo: null });
        fileInput.value = '';
      } catch (error) {
        alert('Error: ' + error.message);
      }
    }

    function setColor(color) {
      currentBackground = { type: 'color', value: color };
      setState({ background: currentBackground });
      const preview = document.getElementById('text-preview');
      preview.style.backgroundColor = color;
      preview.style.animation = 'none';
    }

    function setAnimatedBackground(colors) {
      currentBackground = { type: 'animatedBackground', value: colors };
      setState({ background: currentBackground });
      const preview = document.getElementById('text-preview');
      preview.style.setProperty('--color1', colors[0]);
      preview.style.setProperty('--color2', colors[1]);
      preview.style.setProperty('--color3', colors[2] || colors[0]);
      preview.style.animation = 'backgroundAnimation 15s infinite';
    }

    function setLogo(logoUrl) {
      currentLogo = {
        url: logoUrl,
        position: document.getElementById('logo-position').value,
        scale: document.getElementById('logo-scale').value
      };
      const logoImage = document.getElementById('logo-image');
      logoImage.src = logoUrl;
      logoImage.style.width = `${currentLogo.scale}%`;
      logoImage.style.top = `${currentLogo.position}%`;
      logoImage.style.transform = 'translateX(-50%) translateY(-50%)';
      document.getElementById('preview-logo').style.display = 'block';
      document.getElementById('hide-logo-btn').style.display = 'block';
      setState({ text: null, background: currentBackground, media: null, logo: currentLogo });
    }

    function updateTextPreview() {
      const text = document.getElementById('custom-text').value || 'Texto de ejemplo';
      const font = document.getElementById('text-font').value;
      const size = document.getElementById('text-size').value + 'px';
      const color = document.getElementById('text-color').value;
      const position = document.getElementById('text-position').value;
      const previewText = document.getElementById('preview-text');

      previewText.textContent = text;
      previewText.style.fontFamily = `'${font}', serif`;
      previewText.style.fontSize = size;
      previewText.style.color = color;
      previewText.style.top = `${position}%`;
      previewText.style.transform = 'translateY(-50%)';

      if (currentLogo) {
        const logoImage = document.getElementById('logo-image');
        logoImage.style.width = `${currentLogo.scale}%`;
        logoImage.style.top = `${currentLogo.position}%`;
        logoImage.style.transform = 'translateX(-50%) translateY(-50%)';
      }
    }

    document.getElementById('admin-password').addEventListener('input', (e) => {
      if (e.target.value === 'admin123') {
        document.getElementById('admin-panel').style.display = 'block';
      }
    });

    document.getElementById('upload-btn').addEventListener('click', uploadMedia);
    document.getElementById('custom-color-btn').addEventListener('click', () => {
      const color = document.getElementById('custom-color').value;
      setColor(color);
    });

    document.getElementById('animated-bg-btn').addEventListener('click', () => {
      const color1 = document.getElementById('bg-color1').value;
      const color2 = document.getElementById('bg-color2').value;
      const color3 = document.getElementById('bg-color3').value;
      setAnimatedBackground([color1, color2, color3]);
    });

    document.getElementById('text-btn').addEventListener('click', () => {
      const text = document.getElementById('custom-text').value;
      const font = document.getElementById('text-font').value;
      const size = document.getElementById('text-size').value;
      const color = document.getElementById('text-color').value;
      const position = document.getElementById('text-position').value;
      if (!text) {
        alert('Por favor, ingresa un texto');
        return;
      }
      const textConfig = { text, font, size: parseInt(size), color, position: parseInt(position) };
      setState({ text: textConfig, background: currentBackground, media: null, logo: currentLogo });
    });

    document.getElementById('logo-black-btn').addEventListener('click', () => {
      setLogo(logoBlackUrl);
    });

    document.getElementById('logo-white-btn').addEventListener('click', () => {
      setLogo(logoWhiteUrl);
    });

    document.getElementById('hide-logo-btn').addEventListener('click', () => {
      document.getElementById('preview-logo').style.display = 'none';
      document.getElementById('hide-logo-btn').style.display = 'none';
      currentLogo = null;
      setState({ text: null, background: currentBackground, media: null, logo: null });
    });

    document.getElementById('custom-text').addEventListener('input', updateTextPreview);
    document.getElementById('text-font').addEventListener('change', updateTextPreview);
    document.getElementById('text-size').addEventListener('change', updateTextPreview);
    document.getElementById('text-color').addEventListener('input', updateTextPreview);
    document.getElementById('text-position').addEventListener('input', (e) => {
      document.getElementById('position-value').textContent = `${e.target.value}%`;
      updateTextPreview();
    });

    document.getElementById('logo-position').addEventListener('input', (e) => {
      document.getElementById('logo-position-value').textContent = `${e.target.value}%`;
      if (currentLogo) {
        currentLogo.position = e.target.value;
        updateTextPreview();
        setState({ text: null, background: currentBackground, media: null, logo: currentLogo });
      }
    });

    document.getElementById('logo-scale').addEventListener('input', (e) => {
      document.getElementById('logo-scale-value').textContent = `${e.target.value}%`;
      if (currentLogo) {
        currentLogo.scale = e.target.value;
        updateTextPreview();
        setState({ text: null, background: currentBackground, media: null, logo: currentLogo });
      }
    });

    updateTextPreview();
  </script>
</body>
</html>
