<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=344, initial-scale=1.0">
  <title>Totem Display</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
    }
    #display {
      width: 344px;
      height: 946px;
      position: relative;
    }
    #media {
      width: 100%;
      height: 100%;
      object-fit: contain; /* Default: fit width, may have black bars */
    }
    #media.autofit {
      object-fit: cover; /* Autofit: cover full area, crop excess */
    }
    #text-overlay {
      position: absolute;
      width: 100%;
      text-align: center;
      color: white;
    }
  </style>
</head>
<body>
  <div id="display">
    <div id="text-overlay"></div>
  </div>

  <script>
    function updateDisplay(data) {
      const display = document.getElementById('display');
      const textOverlay = document.getElementById('text-overlay');

      if (data.reset) {
        display.style.background = 'black';
        display.innerHTML = '<div id="text-overlay"></div>';
        return;
      }

      if (data.type) {
        const isVideo = data.type === 'video';
        const element = isVideo ? document.createElement('video') : document.createElement('img');
        element.id = 'media';
        element.src = data.url;
        if (isVideo) {
          element.autoplay = true;
          element.loop = true;
          element.muted = true;
        }
        element.classList.toggle('autofit', data.autofit);
        display.innerHTML = '';
        display.appendChild(element);
        display.appendChild(textOverlay);
      }

      if (data.background) {
        display.style.background = data.background;
      }

      if (data.text) {
        textOverlay.style.fontFamily = data.font;
        textOverlay.style.fontSize = data.fontSize;
        textOverlay.style.color = data.color;
        textOverlay.style.top = `${data.position}%`;
        textOverlay.textContent = data.text;
      }

      if (data.animationSpeed) {
        // Add animation if needed
        display.style.transition = `background ${data.animationSpeed}s`;
      }
    }

    // Placeholder: Receive data from index.html (e.g., WebSocket, postMessage)
    window.addEventListener('message', (event) => {
      updateDisplay(event.data);
    });
  </script>
</body>
</html>
